# 배치 성능 테스트 결과

## 테스트 환경

| 항목 | 사양 |
|------|------|
| CPU | AMD Ryzen 7 9700X (8코어/16스레드, 3.8GHz) |
| RAM | 64GB DDR5-5200 |
| OS | Windows 11 |
| Java | JDK 21 |
| JVM 옵션 | -Xmx40G |

---

## 테스트 조건

| 항목 | 값 |
|------|-----|
| OD 샘플 수 | 1,000개 |
| 데이터 소스 | 서울 대중교통 이용 데이터 (od_na_seoul_2.parquet) |
| 검색 모드 | MULTI_CRITERIA (파레토 최적) |
| 병렬 스레드 | 16개 |

### 알고리즘 설정

| 파라미터 | 값 |
|----------|-----|
| 도보 거리 제한 | 800m |
| 검색 윈도우 | 30분 |
| A* 후보 정류장 | 50개 |
| Access/Egress 정류장 | 30개 |
| 최대 환승 횟수 | 3회 |

---

## 성능 결과

### 처리량

| 항목 | 값 |
|------|-----|
| **총 처리 시간** | **23.04초** |
| **처리량 (병렬)** | **43.4 req/s** |
| 처리량 (단일 스레드 환산) | 2.7 req/s |
| OD 1건당 실질 처리 시간 | **0.023초** (23ms) |

### 검색 시간 분포

| 지표 | 값 | 설명 |
|------|-----|------|
| 평균 | 365ms | 전체 평균 |
| 최소 | 124ms | 가장 빠른 요청 |
| **P50 (중앙값)** | **322ms** | 50%가 이 시간 이내 |
| **P95** | **663ms** | 95%가 이 시간 이내 |
| P99 | 1,319ms | 99%가 이 시간 이내 |
| 최대 | 3,217ms | 가장 느린 요청 |

### 성공률

| 상태 | 개수 | 비율 |
|------|------|------|
| **성공** | **967개** | **96.7%** |
| 경로 없음 | 27개 | 2.7% |
| 실패 | 6개 | 0.6% |

---

## 실패 원인 분석

### 경로 없음 (27개)

| 원인 | 개수 | 설명 |
|------|------|------|
| 장거리 (30km+) | 1개 | GTFS 연결 안됨 |
| 새벽 시간대 | 1개 | 배차 없음 (04:26) |
| 노선 연결 문제 | 25개 | 특정 지역 대중교통 미연결 |

### 실패 (6개)

| 원인 | 개수 | 설명 |
|------|------|------|
| NullPointerException | 5개 | OTP Raptor 내부 버그 |
| IndexOutOfBounds | 1개 | OTP Raptor 내부 버그 |

---

## 데이터 규모

| 항목 | 값 |
|------|-----|
| 정류장 | 212,105개 |
| 노선 (패턴) | 32,229개 |
| 트립 | 349,509개 |
| OSM 노드 | 15,711,249개 |

---

## 핵심 성과

| 목표 | 결과 | 달성 |
|------|------|------|
| 1건당 1초 미만 | **0.365초** (평균) | ✅ |
| 1000건 1분 이내 | **23초** | ✅ |
| 성공률 95%+ | **96.7%** | ✅ |

---

## 설정 튜닝 히스토리

| 설정 변경 | 성공률 | 처리 시간 | 결과 |
|----------|--------|----------|------|
| 400m, 15분, 30후보 | 98.3% | 21초 | 기준 |
| 800m, 30분, 30후보 | 97.9% | 22초 | A* 후보 부족 |
| 800m, 30분, 50후보 | **96.7~98.5%** | **23초** | **최적** |
| 800m, 60분, 50후보 | 93.8% | 24초 | 윈도우 과다 |
| 800m, 30분, 50후보, 50정류장 | 96.9% | 24초 | 정류장 과다 |

---

## 사용법

### 배치 테스트 실행

```cmd
cd korean-otp
batch-test.cmd
```

### 커스텀 실행

```cmd
batch-test.cmd [입력CSV] [출력JSON] [스레드수]
```

### 예시

```cmd
batch-test.cmd data/od_sample_1000.csv result.json 16
```

---

## 결론

- **1000개 OD를 23초에 처리** (목표 60초 대비 2.6배 빠름)
- **초당 43건 처리** 가능 (16스레드 병렬)
- **단일 요청 평균 0.365초** (목표 1초 미만 달성)
- **성공률 96.7%** (GTFS 데이터 한계 고려 시 최적)

---

*테스트 일자: 2025-01-18*
